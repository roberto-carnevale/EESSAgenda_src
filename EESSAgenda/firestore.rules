//rules_version = '2';
//service cloud.firestore {
//  match /databases/{database}/documents {
//    match /{document=**} {
//      allow read, write: if
//          request.time < timestamp.date(2022, 6, 23);
//    }
//  }
rules_version = '2';
service cloud.firestore {
  /// Function for determining Gestore, GuidaSmart o Amministratore
  match /databases/{database}/documents {
      
    function isManager() {
      return get(/databases/$(database)/documents/utenti/$(request.auth.token.email)).data.ruolo in [0,3,4];
    }

    //Regole per Utenti
    match /utenti/{utente=*} {
      allow create: if request.auth != null && request.resource.data.ruolo != 0;
      allow read : if request.auth != null;
      allow update : if request.auth != null && request.resource.data.ruolo != 0 && isManager();
    }

    match /agenda/{doc=*} {
      allow read, write: if request.auth != null
    }

    //Lettura corsi aperta per autoisrizione
    match /corsi/{doc=*} {
      allow read: if true
      allow write : if request.auth != null && isManager();
    }

    match /home/{doc=*} {
      allow read, write: if request.auth != null
    }
    match /chat/{doc=*} {
      allow read, write: if request.auth != null
    }
    
  }
}